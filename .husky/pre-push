#!/bin/bash

while read local_ref local_sha remote_ref remote_sha; do
    if [[ "$remote_ref" =~ refs/tags/ ]]; then
        TAG_NAME=${remote_ref#refs/tags/}
        if [[ ! "$TAG_NAME" =~ ^v[0-9]{4}\.[0-9]{2}\.[0-9]{2}\.[0-9]{4}(-(staging|sandbox))?$ ]]; then
            echo "Error: Tag name format is incorrect."
            echo "Tags must follow the pattern vYYYY.MM.DD.HHmm, vYYYY.MM.DD.HHmm-staging, vYYYY.MM.DD.HHmm-sandbox"
            echo "Use 'npm run tag:create' or 'npm run tag:create:staging' for convenience."
            exit 1
        fi
    fi
done
